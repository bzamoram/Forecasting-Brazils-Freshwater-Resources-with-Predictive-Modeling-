---
title: "Forecasting-Brazils-Freshwater-Resources-with-Predictive-Modeling"
author: "Bryan Z"
date: "2023-11-25"
output:  
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    theme: cosmo
    highlight: tango
    code_folding: show
    fig_width: 10
    fig_height: 6
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.align = 'center',
  fig.width = 10,
  fig.height = 6
)

# Close any open devices
graphics.off()

# Time series packages
library(fpp3)        
library(forecast)
library(urca)

# Data manipulation
library(tidyverse)

# Specialized
library(tidyxl)
library(tsibbledata)
library(fabletools)

```

## Introduction 

James is a junior data analyst working in the sustainability analyst team at Clarkston Consulting, a consulting company in Rio, Brazil. Moreno (director of his floor) requests a forecast report on the Renewable Internal Freshwater Resources of Brazil for the next 10 years.

James is sent to Morticia for the data he will use. Then, he is provided a dataset titled: "Renewable internal freshwater resources per capita (cubic meters)" from the website "Our World in Data". He is left with a forecast report but not with the variables he could use to produce it. 

After doing some research, he finds out that renewable internal freshwater resources (cubic meters) is the internal renewable resources in the country, such as internal river flows and groundwater from rainfall. Besides, he realizes that accounting for this is important for assessing a region's water security, for sustainable agriculture practices or for early detection of drought conditions since climate change is all over the news nowadays. 

James realizes that he should not consider population count for this report since the company requesting the consulting service does not need the forecast based on the population but rather on the consumption on water withdrawals from industrial and agricultural processes. 

In order to conduct the forecast, James needs to do some feature engineering for the dataset provided by Morticia. He goes ahead and gets the worldwide population data from the World Bank in order to obtaining the Renewable Internal Freshwater Resources of Brazil without counting capita. Based on the initial dataset, he filters the now ready Renewable Internal Freshwater Resources of Brazil for the years 1989 to 2019 since these are the years stored for Brazil in the dataset provided. 

### Feature Engineering for Renewable Internal Freshwater Resources (cubic meters)

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Population Data
population <- read.csv('data/world-population.csv', header = TRUE, skip = 4)

population_long <- population |>
  pivot_longer(
    cols = -c('Country.Name', 'Country.Code', 'Indicator.Name', 'Indicator.Code'),
    names_to = "Year",
    values_to = "Population"
  ) |>
  mutate(Year = as.integer(str_remove(Year, "X")))

filtered_population_long <- population_long |>
  filter(Country.Name == "Brazil" & Year >= 1989 & Year <= 2019) |>
  select(Year, Population)

# view(filtered_population_long)

```

```{r, include=TRUE, eval=TRUE, echo=TRUE}
#Renewable Freshwater Data
renew_h2o = read.csv('data/renewable-water-resources-per-capita.csv', header = TRUE)
#view(renew_h2o) 

filtered_renew_h2o <- renew_h2o |>
  filter(Entity == "Brazil" & Year >= 1989 & Year <= 2019) |>
  select(Year, Renewable.internal.freshwater.resources.per.capita..cubic.meters.)
#filtered_renew_h2o

#str(filtered_renew_h2o)
```

```{r, include=TRUE, eval=TRUE, echo=TRUE}
#Pure Feature Engineering
joined_data <- left_join(filtered_population_long, filtered_renew_h2o, by = "Year")
#joined_data

renew_h2o_clean <- joined_data %>%
  mutate(Renewable.internal.freshwater.resources..cubic.meters = 
           Renewable.internal.freshwater.resources.per.capita..cubic.meters. / Population) |>
  select(-Population, -Renewable.internal.freshwater.resources.per.capita..cubic.meters.)

# Create tsibble
ttsibble_data <- as_tsibble(renew_h2o_clean, index = Year)

# Display data
knitr::kable(head(ttsibble_data, 10), caption = "Renewable Freshwater Resources (First 10 Years)")
```

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Plot using ggplot2 
ttsibble_data %>%
  as.data.frame() %>%
  ggplot(aes(x = Year, y = Renewable.internal.freshwater.resources..cubic.meters)) +
  geom_line(color = "#2C3E50", size = 1.2) +
  geom_point(color = "#E74C3C", size = 2.5) +
  scale_x_continuous(breaks = seq(1989, 2019, by = 5)) +
  ggtitle("Renewable Internal Freshwater Resources Over Time") +
  xlab("Year") +
  ylab("Renewable Internal Freshwater Resources (cubic meters)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title = element_text(size = 12),
    panel.grid.minor = element_blank()
  )
```

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Calculate the annual percentage decrease
initial_count <- 0.0002584340
final_count <- 0.0001262151
initial_year <- 1989
final_year <- 2019

annual_percentage_decrease <- ((final_count / initial_count)^(1 / (final_year - initial_year)) - 1) * -100

cat("Annual Percentage Decrease:", round(annual_percentage_decrease, 2), "%\n")

```

James quickly realizes that the renewable internal freshwater resources of Brazil have been declining over the years, especially since 1989 these resources had a value of 0.0002584340 cubic meters and for 2019 the number shrunk to 0.0001262151	cubic meters. This reflects an annual percentage decrease of 2.36 %. 

To continue, James realizes that two of the time series he will explore for the forecast report will be "Number of Cattle" and "Annual freshwater withdrawals" since these time series align with the requirements. 

The "Number of Cattle" dataset was extracted from "Our World in Data" and it indicates the number of animals of the species present in the country at the time of enumeration. It includes animals raised either for draft purposes or for meat, eggs and dairy production or kept for breeding. 

### Annual Cattle Number 

```{r, include=TRUE, eval=TRUE, echo=TRUE}
cattle_heads = read.csv('data/cattle-livestock-count-heads.csv', header = TRUE)
#view(cattle_heads)

filtered_cattle_heads <- cattle_heads |>
  filter(Entity == "Brazil" & Year >= 1989 & Year <= 2019) |>
  select(Year, Cattle...00000866....Stocks...005111....animals)

ttsibble_data <- as_tsibble(filtered_cattle_heads, index = Year)
ttsibble_data |> autoplot()+
  ggtitle("Cattle Livestock Count in Brazil (1989-2019)") +
  xlab("Year") +
  ylab("Cattle Livestock Count")
ttsibble_data

# Calculate the annual percentage increase
initial_count <- 144154096
final_count <- 215008960
initial_year <- 1989
final_year <- 2019

annual_percentage_increase <- ((final_count / initial_count)^(1 / (final_year - initial_year)) - 1) * 100
#print(paste("Annual Percentage Increase: ", round(annual_percentage_increase, 2), "%"))
```

James reflects on the increasing cattle number in Brazil since 1989 to 2019. In 1989 the cattle count was 144154096 and for 2019 it counted for 215008960, meaning an annual percentage increase of 1.34 %.

The other time series,"Annual freshwater withdrawals", refers to total water withdrawals. It also includes water from desalination plants, agriculture (irrigation and livestock production), industry (cooling thermoelectric plants) and domestic uses (drinking water, municipal use or supply, use for public services, commercial establishments, and homes). 

### Annual Freshwater Withdrawals

```{r, include=TRUE, eval=TRUE, echo=TRUE}
fresh_h2o = read.csv('data/annual-freshwater-withdrawals.csv', header = TRUE)
#view(fresh_h2o)

filtered_fresh_h2o <- fresh_h2o |>
  filter(Entity == "Brazil" & Year >= 1989 & Year <= 2019) |>
  select(Year, Annual.freshwater.withdrawals..total..billion.cubic.meters.)

ttsibble_data <- as_tsibble(filtered_fresh_h2o, index = Year)
ttsibble_data |> autoplot()+
  ggtitle("Annual Freshwater Withdrawals in Brazil (1989-2019)") +
  xlab("Year") +
  ylab("Annual Freshwater Withdrawals (billion cubic meters)")
ttsibble_data

# Calculate the annual percentage increase
initial_count <- 39446667000
final_count <- 70430000000
initial_year <- 1989
final_year <- 2019

annual_percentage_increase <- ((final_count / initial_count)^(1 / (final_year - initial_year)) - 1) * 100
#print(paste("Annual Percentage Increase: ", round(annual_percentage_increase, 2), "%"))
```

James reflects on the increasing freshwater withdrawals in Brazil since 1989 to 2019. In 1989 the water withdrawal was 39446667000 cubic meters and for 2019 it was 70430000000 cubic meters, meaning an annual percentage increase of 1.95 %.

Down below, the dataset that James creates with all the time series for his forecast report on the Renewable Internal Freshwater Resources of Brazil for the next 10 years.

### Joining Variables

```{r, include=TRUE, eval=TRUE, echo=TRUE}
ultimate_joined_data <- left_join(renew_h2o_clean, filtered_cattle_heads, by = "Year")

#Creating the three datasets into a joined one
definitive_joined_data <- left_join(ultimate_joined_data, filtered_fresh_h2o, by = "Year")

#Making it a tsible object
ttsibble_data <- as_tsibble(definitive_joined_data, index = Year)
# ttsibble_data |> autoplot()
ttsibble_data
```

Once being ready, James decides on using Dynamic Regression with ARIMA Errors for his forecast report. 

## Dynamic Regression

To start off, he checks for the time series if they are stationary and finds out that they certainly are. 

#### Stationarity 

```{r, include=TRUE, eval=TRUE, echo=TRUE}
ur.kpss(diff(diff(ttsibble_data$Renewable.internal.freshwater.resources..cubic.meters,lag = 1),lag = 1)) |> summary()
```

The test statistic (0.9723) is less than the critical values at all significance levels. Therefore, he fails to reject the null hypothesis stating that the time series is stationary, or, in other words, he accepts that the time series is stationary.

```{r, include=TRUE, eval=TRUE, echo=TRUE}
ur.kpss(diff(diff(ttsibble_data$Cattle...00000866....Stocks...005111....animals,lag = 1),lag = 1)) |> summary()
```

The test statistic (0.045) is less than the critical values at all significance levels, which again, he fails to reject the null hypothesis indicating that the time series is stationary, or, in other words, he accepts that the time series is stationary.

```{r, include=TRUE, eval=TRUE, echo=TRUE}
ur.kpss(diff(diff(ttsibble_data$Annual.freshwater.withdrawals..total..billion.cubic.meters.,lag = 1),lag = 1)) |> summary()
```

Once again, the test statistic (0.1532) is less than the critical values at all significance levels. Thus, he fails to reject the null hypothesis suggesting that the time series for Annual Freshwater Withdrawals is stationary. 

Now, it is time for James to fit the models and create forecasts for the future 10 years.

#### Model #1

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Fit Dynamic Regression with ARIMA Errors
# Response: Renewable Freshwater Resources
# Predictor: Cattle Numbers
fit_ren_fresh <- ttsibble_data %>%
  model(ARIMA(Renewable.internal.freshwater.resources..cubic.meters ~ 
              Cattle...00000866....Stocks...005111....animals))

# Display model summary
report(fit_ren_fresh)
```

James modeled the time series "Renewable.internal.freshwater.resources..cubic.meters" using an ARIMA model with an external regressor, specifically the variable "Cattle...00000866....Stocks...005111....animals."  The ARIMA component was automatically selected as ARIMA(0,0,0) 

James, then, proceeded to evaluate the residuals as follows to provide insights into the model's performance.

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Fitted vs Observed Plot
fit_ren_fresh %>% 
  augment() %>%
  autoplot(.fitted, color = 'blue') +
  autolayer(ttsibble_data, Renewable.internal.freshwater.resources..cubic.meters) +
  ggtitle("Fitted vs Observed - Renewable Internal Freshwater Resources") +
  xlab("Year") +
  ylab("Renewable Internal Freshwater Resources (cubic meters)") +
  theme_minimal()

# Residual Diagnostics
fit_ren_fresh %>% 
  gg_tsresiduals() +
  labs(title = "Time Series Residuals - Model 1",
       x = "Time",
       y = "Residuals")

# Ljung-Box Test for residual autocorrelation
ljung_box_results <- augment(fit_ren_fresh) %>% 
  features(.innov, ljung_box, lag = 14)

knitr::kable(ljung_box_results, 
             caption = "Ljung-Box Test Results",
             digits = 4)
```

James proceeded to evaluate the residuals to assess the model's performance.

Findings:

- Residuals plot: The residuals show a clear systematic pattern over time rather than random scatter around zero. There is a notable downward trend from 1990-2000, followed by an upward movement through the mid-2000s, and continued variation thereafter. This pattern suggests the model has not fully captured all systematic components in the data.

- ACF plot: The autocorrelation function shows minimal spikes outside the confidence bounds (blue dashed lines), suggesting limited autocorrelation at individual lags when examined visually.
- Histogram: Residuals appear approximately normally distributed and centered near zero, which is a positive indicator for the model.
- Ljung-Box test: With a p-value of 0.000 (essentially zero), which is significantly less than 0.05, we reject the null hypothesis of no autocorrelation. This indicates significant autocorrelation remains in the residuals, suggesting the model has not adequately captured all temporal dependencies.
- Fitted vs Observed plot: The fitted values (blue line) follow a smooth declining trend but fail to capture the fluctuations and variations in the observed data (black line), particularly the volatility in the 1990s-2000s period.

Overall Assessment: The model demonstrates inadequate performance in capturing the relationship between cattle numbers and renewable freshwater resources. The significant residual autocorrelation (Ljung-Box p-value = 0) and clear patterns in the residuals plot indicate that important dynamics remain unmodeled. This suggests that:

1. The simple linear relationship with cattle may be insufficient
2. Additional predictors or non-linear transformations may be needed
3. A more complex ARIMA structure might be required to capture the temporal dynamics

Despite these limitations, James proceeds with the forecast to provide initial insights, while noting that Model 2 (incorporating freshwater withdrawals) may offer improved performance.

##### Forecasting 

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# STEP 1: Forecast the predictor (cattle numbers) for next 10 years
# Since we need cattle values to predict freshwater, we must forecast cattle first
cattle_model <- ttsibble_data %>%
  model(ARIMA(Cattle...00000866....Stocks...005111....animals))

cattle_forecast <- cattle_model %>%
  forecast(h = 10)

# Display cattle forecast
knitr::kable(
  cattle_forecast %>% 
    as_tibble() %>%
    select(Year, .mean) %>%
    rename(`Forecasted Cattle Count` = .mean),
  caption = "Forecasted Cattle Numbers (2020-2029)",
  format.args = list(big.mark = ",")
)
```

To forecast renewable freshwater resources using the dynamic regression model, James first needed to generate forecasts for the predictor variable (cattle numbers) for the next 10 years.

Cattle Forecast Results:

The cattle population is projected to steadily increase from approximately 216.8 million head in 2020 to 237.3 million head in 2029, representing a 9.5% increase over the forecast horizon. This translates to an average annual growth of approximately 2.1 million cattle per year, or roughly 1.0% annually.

Key Observations:

  - The forecasted growth follows a consistent upward trajectory throughout the entire period
  - The increase aligns with Brazil's historical trend of cattle herd expansion (recall the 1.34% annual increase observed from 1989-2019)
  - By 2029, Brazil's cattle population is expected to reach nearly 237.3 million head, continuing its position as one of the world's largest cattle producers
  - This sustained growth in cattle numbers has important implications for renewable freshwater resources, as cattle farming is a significant consumer of water resources 

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# STEP 2: Create future scenarios with forecasted cattle values
future_scenarios <- new_data(ttsibble_data, n = 10) %>%
  mutate(Cattle...00000866....Stocks...005111....animals = cattle_forecast$.mean)

# STEP 3: Forecast renewable freshwater using the dynamic regression model
freshwater_forecast <- fit_ren_fresh %>%
  forecast(new_data = future_scenarios)

# Display forecast table with confidence intervals
knitr::kable(
  freshwater_forecast %>%
    hilo(level = c(80, 95)) %>%
    select(Year, .mean, `80%`, `95%`) %>%
    rename(
      `Point Forecast` = .mean,
      `80% Interval` = `80%`,
      `95% Interval` = `95%`
    ),
  caption = "10-Year Forecast: Renewable Freshwater Resources (cubic meters)",
  digits = 10
)
```

Using the forecasted cattle numbers as inputs, James generated the 10-year forecast for renewable internal freshwater resources.

Forecast Results:

The model predicts a gradual decline in renewable freshwater resources from approximately 0.000132 cubic meters in 2020 to 0.000103 cubic meters in 2029. This represents an overall 22.5% decrease over the forecast horizon, or an average annual decline of approximately 2.5% per year.

Key Findings:

  - The forecast indicates continued depletion of Brazil's renewable freshwater resources throughout the next decade
  - The decline accelerates the historical trend observed from 1989-2019 (which showed a 2.36% annual decrease)
  - By 2029, renewable freshwater resources per unit are expected to reach 0.000103 cubic meters, the lowest level in the observed and forecasted time series
  - The negative relationship with cattle numbers suggests that as cattle populations grow, freshwater resources continue to diminish

Confidence Intervals:

  - The 80% prediction interval indicates that there is an 80% probability that actual values will fall within the narrower range (shown in the darker shaded region)
  - The 95% prediction interval provides a wider range with higher confidence (shown in the lighter shaded region)
  - The intervals widen progressively over time, reflecting increasing uncertainty in longer-term predictions
  - Even at the upper bounds of the 95% interval, all forecasted years show values below the 2019 historical level (0.000126 cubic meters), confirming the robust downward trend

Implications:

This forecast raises significant concerns about Brazil's water security over the next decade, particularly given the simultaneous increase in cattle populations (a water-intensive industry) and declining renewable freshwater availability. The widening confidence intervals suggest greater uncertainty in long-term projections, highlighting the need for adaptive water management strategies.

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Visualize the forecast
freshwater_forecast %>%
  autoplot(ttsibble_data, level = c(80, 95)) +
  labs(
    title = "10-Year Forecast: Renewable Freshwater Resources\n(Based on Dynamic Regression with Cattle Numbers)",
    x = "Year",
    y = "Renewable Internal Freshwater Resources (cubic meters)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    legend.position = "bottom"
  ) +
  scale_color_manual(
    values = c("Historical Data" = "black", "Forecast" = "blue"),
    name = ""
  )
```

The visualization above shows:

  - Black line: Historical renewable freshwater resources (1989-2019), displaying a consistent downward trend over the 30-year period
  - Blue line: Point forecasts (2020-2029), continuing the declining trajectory
  - Dark blue shaded area: 80% prediction interval
  - Light blue shaded area: 95% prediction interval

Key Insights:

1. The forecast suggests a continued declining trend in renewable freshwater resources, maintaining the downward trajectory established in the historical period. The decline appears linear and consistent throughout the forecast horizon.
2. The relationship with cattle numbers indicates that as cattle populations increase, freshwater resources are expected to decrease. This inverse relationship reflects the water-intensive nature of cattle farming and its impact on Brazil's renewable water availability.
3. The widening prediction intervals reflect increasing uncertainty in the long-term forecast. The gap between the 80% and 95% intervals expands noticeably from 2020 to 2029, indicating that confidence in precise predictions diminishes as we project further into the future.
4. By 2029, the model predicts renewable freshwater resources will be approximately 0.000103 cubic meters, representing an 18.6% decrease from 2019 levels (0.000126 cubic meters). This decline is particularly concerning as it compounds the already significant 51.2% decrease observed from 1989 to 2019, suggesting an accelerating depletion of Brazil's renewable water resources.
5. Visual continuity: The forecast seamlessly extends the historical trend with no abrupt changes, suggesting the model has identified a persistent underlying relationship between cattle populations and water resource depletion that is expected to continue without intervention.

#### Model #2

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Fit Dynamic Regression with ARIMA Errors
# Response: Renewable Freshwater Resources
# Predictor: Annual Freshwater Withdrawals
fit_dyn_withdrawals <- ttsibble_data %>%
  model(ARIMA(Renewable.internal.freshwater.resources..cubic.meters ~ 
              Annual.freshwater.withdrawals..total..billion.cubic.meters.))

# Display model summary
report(fit_dyn_withdrawals)
```

James modeled the time series "Renewable.internal.freshwater.resources..cubic.meters" using an ARIMA model with an external regressor, specifically the variable "Annual.freshwater.withdrawals..total..billion.cubic.meters."

Model Specification:

The ARIMA component was automatically selected as ARIMA(0,0,0), which indicates a simple linear regression model with no autoregressive, differencing, or moving average components. This is the same structure as Model 1 (cattle predictor).

Model Equation:

```{}
Renewable Freshwater = 0.0004 + 0.0 × Annual Withdrawals + error
```

Key Observations:

  - Intercept: 0.0004 (4e-04) cubic meters
  - Coefficient for Annual Withdrawals: Approximately 0 (0e+00)
  - Standard Error: 0.0002 for both parameters
  - Sigma²: 4.169e-09 (Model 2) vs 1.164e-10 (Model 1)

Critical Finding: The coefficient for annual freshwater withdrawals is essentially zero, suggesting that in this simple linear model framework, annual withdrawals do not appear to have a significant direct relationship with renewable freshwater resources. This is surprising and counterintuitive, as one would expect increased withdrawals to correlate with decreased renewable resources.

Model Comparison:

  - Model 1 (cattle): Sigma² = 1.164e-10, AIC = -617.2
  - Model 2 (withdrawals): Sigma² = 4.169e-09, AIC = -507.2
  - Model 1 has a much smaller error variance (sigma²) and better AIC (more negative is better), indicating superior fit to the data

Interpretation: The lack of a significant relationship with withdrawals in this model may indicate that:

  1. The relationship between withdrawals and renewable resources is more complex than a simple linear association
  2. Cattle numbers may be a better proxy for overall water stress in Brazil
  3. Withdrawals data may have measurement issues or represent only part of total water consumption
  4. Non-linear transformations or additional variables may be needed to capture the relationship

James, then, proceeded to evaluate the residuals as follows to provide insights into the model's performance.

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Fitted vs Observed Plot
fit_dyn_withdrawals %>% 
  augment() %>%
  autoplot(.fitted, color = 'blue') +
  autolayer(ttsibble_data, Renewable.internal.freshwater.resources..cubic.meters) +
  ggtitle("Fitted vs Observed - Renewable Internal Freshwater Resources (Model 2)") +
  xlab("Year") +
  ylab("Renewable Internal Freshwater Resources (cubic meters)") +
  theme_minimal()

# Residual Diagnostics
fit_dyn_withdrawals %>% 
  gg_tsresiduals() +
  labs(title = "Time Series Residuals - Model 2 (Freshwater Withdrawals)",
       x = "Time",
       y = "Residuals")

# Ljung-Box Test
ljung_box_results_m2 <- augment(fit_dyn_withdrawals) %>% 
  features(.innov, ljung_box, lag = 14)

knitr::kable(ljung_box_results_m2, 
             caption = "Ljung-Box Test Results - Model 2",
             digits = 4)
```

Findings:

  - Residuals plot: The residuals exhibit a severe systematic pattern rather than random scatter. There is a pronounced downward linear trend from 1989 through approximately 2010, followed by a plateau. This clear pattern indicates the model has completely failed to capture the underlying dynamics of the data.
  - ACF plot: The autocorrelation function shows multiple significant spikes extending well beyond the confidence bounds (blue dashed lines), particularly at early lags (1-3). This indicates strong autocorrelation in the residuals.
  - Histogram: The residuals show a somewhat normal distribution but with a slight right skew. However, the distribution shape is less concerning than the severe autocorrelation.
  - Ljung-Box test: With a p-value of 0.000 (essentially zero), which is significantly less than 0.05, we strongly reject the null hypothesis of no autocorrelation. This confirms severe autocorrelation in the residuals.
  - Fitted vs Observed plot: This reveals the core problem - the fitted values (blue line) form an almost completely flat horizontal line, while the observed data (black line) shows a clear declining trend. The model has essentially failed to explain any of the temporal variation in the data.

Comparison to Model 1:

  - Model 1 (cattle predictor): Ljung-Box p = 0.000, showed systematic residual patterns
  - Model 2 (withdrawals predictor): Ljung-Box p = 0.000, shows even worse systematic patterns
  - Model 2 is significantly worse: The fitted line in Model 2 is nearly flat, whereas Model 1 at least captured the general declining trend
  - Neither model is adequate, but Model 1 demonstrates superior performance

Overall Assessment:

Model 2 demonstrates very poor performance. The near-zero coefficient for freshwater withdrawals combined with the flat fitted line indicates this predictor provides virtually no explanatory power for renewable freshwater resources. The severe residual autocorrelation (Ljung-Box p = 0.000) and clear systematic pattern suggest:

1. Annual freshwater withdrawals alone cannot explain the variation in renewable resources
2. The simple linear regression framework (ARIMA(0,0,0)) is inadequate for this relationship
3. Model 1 with cattle numbers as a predictor, while imperfect, substantially outperforms Model 2

Recommendation: Model 1 should be preferred for forecasting purposes, despite its own diagnostic limitations. Model 2's complete failure to capture the data trend makes it unsuitable for reliable predictions.


##### Forecasting

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# STEP 1: Forecast the predictor (annual freshwater withdrawals) for next 10 years
withdrawals_model <- ttsibble_data %>%
  model(ARIMA(Annual.freshwater.withdrawals..total..billion.cubic.meters.))

withdrawals_forecast <- withdrawals_model %>%
  forecast(h = 10)

# Display withdrawals forecast
knitr::kable(
  withdrawals_forecast %>% 
    as_tibble() %>%
    select(Year, .mean) %>%
    rename(`Forecasted Withdrawals (billion m³)` = .mean),
  caption = "Forecasted Annual Freshwater Withdrawals (2020-2029)",
  format.args = list(big.mark = ","),
  digits = 2
)
``` 

To forecast renewable freshwater resources using Model 2, James first generated forecasts for annual freshwater withdrawals for the next 10 years.

Freshwater Withdrawals Forecast:

Annual freshwater withdrawals are projected to remain completely stable at approximately 74.14 billion cubic meters for the entire forecast period from 2020 to 2029, representing a 0% change over the forecast horizon.

Critical Observation:

This forecast is essentially a naive persistence forecast - projecting the same value forward for all 10 years with no variation. This occurs because the ARIMA model for withdrawals likely selected a random walk or simple mean model with no trend or autoregressive components.

Comparison to Historical Trend:

  - 2019 actual value: 70.43 billion cubic meters
  - 2020 forecast: 74.14 billion cubic meters (5.3% jump)
  - 2020-2029: Flat at 74.14 billion (no growth)
  - Historical trend (1989-2019): 1.95% annual growth

Problem: This forecast contradicts the established historical trend of increasing freshwater withdrawals in Brazil. The flat projection ignores:

1. Population growth
2. Industrial expansion
3. Agricultural intensification
4. The consistent 1.95% annual increase observed from 1989-2019

Implication for Model 2:

Using a flat withdrawal forecast as input to predict renewable freshwater resources is problematic because:

  - It assumes water demand will suddenly stabilize after decades of growth
  - The lack of variation in the predictor will produce unrealistic forecasts for the response variable
  - This further undermines the credibility of Model 2's predictions

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# STEP 2: Create future scenarios with forecasted withdrawals
future_scenarios_m2 <- new_data(ttsibble_data, n = 10) %>%
  mutate(Annual.freshwater.withdrawals..total..billion.cubic.meters. = 
           withdrawals_forecast$.mean)

# STEP 3: Forecast renewable freshwater using Model 2
freshwater_forecast_m2 <- fit_dyn_withdrawals %>%
  forecast(new_data = future_scenarios_m2)

# Display forecast table
knitr::kable(
  freshwater_forecast_m2 %>%
    hilo(level = c(80, 95)) %>%
    select(Year, .mean, `80%`, `95%`) %>%
    rename(
      `Point Forecast` = .mean,
      `80% Interval` = `80%`,
      `95% Interval` = `95%`
    ),
  caption = "10-Year Forecast: Renewable Freshwater Resources - Model 2 (cubic meters)",
  digits = 10
)

``` 

Using the forecasted freshwater withdrawals as inputs, James generated the 10-year forecast for renewable freshwater resources using Model 2.

Forecast Results:

Model 2 predicts complete stability in renewable freshwater resources, with the point forecast remaining absolutely constant at 0.0002091256 cubic meters for every single year from 2020 to 2029, representing 0% change over the entire forecast horizon.

Alarming Discontinuity:

  - 2019 actual value: 0.0001262151 cubic meters
  - 2020 Model 2 forecast: 0.0002091256 cubic meters
  - This represents a 65.7% sudden increase from 2019 to 2020, then complete flatness for a decade

This forecast is completely implausible because:

  1. It contradicts the 30-year declining trend (2.36% annual decrease from 1989-2019)
  2. It predicts an immediate 65.7% jump followed by perfect stability
  3. The identical confidence intervals across all 10 years indicate the model assumes zero uncertainty growth over time

Comparison to Model 1 key Differences:

1. Trend Direction:
  - Model 1 continues the historical declining trend (realistic)
  - Model 2 predicts sudden increase then stability (unrealistic)

Confidence Intervals:

  - Model 1: Intervals widen progressively (0.000119-0.000147 in 2020 → 0.000082-0.000124 in 2029)
  - Model 2: Intervals remain identically fixed at 0.000126-0.000292 for all years (statistically impossible)

Forecast Credibility:

  - Model 1 shows a 23% more severe outcome by 2029 but follows historical patterns
  - Model 2 shows zero decline and contradicts all observed trends

Overall Assessment:

Model 2 has produced a mechanically flawed forecast that is unusable for policy or planning purposes. The flat point forecast and fixed confidence intervals across 10 years indicate the model is simply projecting the mean value forward with no temporal dynamics. This occurs because:

  - The predictor (withdrawals) has a flat forecast
  - The model coefficient for withdrawals is near zero
  - The result is essentially a horizontal line ignoring all historical trends

Conclusion: Model 1, despite its diagnostic limitations, is vastly superior to Model 2 for forecasting Brazil's renewable freshwater resources. Model 2's complete departure from reality makes it unsuitable for any practical application.

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Visualize Model 2 forecast
freshwater_forecast_m2 %>%
  autoplot(ttsibble_data, level = c(80, 95)) +
  labs(
    title = "10-Year Forecast: Renewable Freshwater Resources\n(Based on Dynamic Regression with Freshwater Withdrawals)",
    x = "Year",
    y = "Renewable Internal Freshwater Resources (cubic meters)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    legend.position = "bottom"
  )
```

The visualization shows:

  - Black line: Historical data (1989-2019) displaying a clear, consistent downward trend
  - Forecast section (2020-2029): Appears as a flat horizontal segment (not visible as a distinct blue line because all values are identical)
  - Shaded areas: 80% (darker blue) and 95% (lighter blue) prediction intervals displayed as a fixed vertical rectangle rather than expanding cones

Key Insights from Model 2:

  1. Trend Direction: The forecast shows zero trend - a completely flat horizontal projection that sharply contradicts the historical declining pattern. There is a visible discontinuity where the black historical line (declining) meets the forecast period (flat rectangle).
  2. Relationship with Withdrawals: The model suggests no meaningful relationship between freshwater withdrawals and renewable resources, as evidenced by the near-zero coefficient and flat forecast. The constant projection implies withdrawals have no predictive power.
  3. Prediction Intervals: The intervals form a vertical rectangle with no widening over time, which is statistically implausible. In contrast, Model 1 showed proper expanding confidence bands (cone shape). Model 2's fixed intervals suggest the model is treating all future years as equally uncertain - a fundamental flaw.
  4. Visual Discontinuity: There is an obvious upward jump from the 2019 endpoint (~0.000126) to the forecast level (~0.000209), followed by a flat plateau. This represents a 65.7% increase that reverses three decades of decline.
  5. By 2029: Resources are expected to remain at 0.000209 cubic meters - higher than any point since approximately 1995, contradicting all evidence of ongoing depletion.
  
Recommendation:

Based on diagnostic performance and forecast credibility, Model 1 is vastly superior and should be used for all planning and policy purposes. Model 2 is fundamentally flawed and produces forecasts that:

   - Contradict 30 years of observed trends
  - Show a statistically impossible fixed uncertainty band
  - Predict an implausible reversal of resource depletion
  - Provide no useful information for decision-making

While Model 1 has its own diagnostic issues (residual autocorrelation), it at least:

  - Captures the general declining trend
  - Shows realistic expanding uncertainty
  - Aligns with historical patterns
  - Provides actionable forecasts for water resource planning

Conclusion: James should present Model 1 results to Moreno and explicitly note that Model 2 failed to produce credible forecasts, demonstrating the importance of appropriate predictor selection in time series modeling.
  
## Scenario Analysis 

Having established that Model 1 (using cattle numbers as a predictor) provides the most credible forecasts, James explores various policy scenarios to understand how different trajectories in cattle population could impact Brazil's renewable freshwater resources over the next 5 years.

Policy Context

Brazil faces competing pressures:

  - Economic: Cattle farming is a major industry contributing significantly to GDP
  - Environmental: Growing cattle populations increase water stress and carbon emissions
  - Sustainability: Vision Zero and climate commitments require reduced environmental impact

James develops four scenarios representing different policy approaches to cattle management.

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Base parameters
base_cattle_2019 <- 215008960  # Last observed value
forecast_years <- 5
scenario_years <- 2020:2024

# Create scenario function
create_cattle_scenario <- function(annual_change_pct, base_value, years) {
  values <- numeric(years)
  values[1] <- base_value * (1 + annual_change_pct)
  
  if (years > 1) {
    for (i in 2:years) {
      values[i] <- values[i - 1] * (1 + annual_change_pct)
    }
  }
  return(values)
}

# Generate scenarios
scenario_data <- data.frame(
  Year = scenario_years,
  
  # Scenario 1: Business as Usual (1.34% annual growth - historical rate)
  BAU = create_cattle_scenario(0.0134, base_cattle_2019, forecast_years),
  
  # Scenario 2: Modest Reduction (1% annual decrease)
  Modest_Reduction = create_cattle_scenario(-0.01, base_cattle_2019, forecast_years),
  
  # Scenario 3: Aggressive Reduction (3% annual decrease)
  Aggressive_Reduction = create_cattle_scenario(-0.03, base_cattle_2019, forecast_years),
  
  # Scenario 4: Climate Action (5% annual decrease)
  Climate_Action = create_cattle_scenario(-0.05, base_cattle_2019, forecast_years)
)

# Display scenario values
knitr::kable(
  scenario_data,
  caption = "Cattle Population Scenarios (2020-2024)",
  format.args = list(big.mark = ","),
  digits = 0
)
```

Scenario Descriptions:

  1. Business as Usual (BAU): Cattle continue growing at the historical 1.34% annual rate observed from 1989-2019
  2. Modest Reduction: Policy interventions achieve a 1% annual decrease through improved efficiency
  3. Aggressive Reduction: Strong policy measures reduce herd size by 3% annually
  4. Climate Action: Comprehensive climate initiatives reduce cattle by 5% per year

James develops four scenarios representing different policy approaches to cattle management, each reflecting a distinct balance between economic considerations and environmental sustainability.

Scenario Design:

Starting from the 2019 baseline of 215.0 million cattle, James projects forward five years under four different annual growth rate assumptions:

1. Business as Usual (BAU) - +1.34% annual growth
  - Represents continuation of the historical trend observed from 1989-2019
  - Cattle population grows from 217.9 million in 2020 to 229.8 million by 2024
  - This results in a 6.9% increase (11.9 million additional cattle) over the 5-year period
  - Reflects a scenario with no policy intervention and continued industry expansion

2. Modest Reduction - -1.0% annual decrease
  - Represents achievable reduction through improved efficiency and moderate policy measures
  - Cattle population decreases from 212.9 million in 2020 to 204.5 million by 2024
  - This results in a 4.9% decrease (10.5 million fewer cattle) over the period
  - Could be achieved through natural attrition, improved productivity per animal, and voluntary industry cooperation

3. Aggressive Reduction - -3.0% annual decrease
  - Represents strong policy intervention with enforceable reduction targets
  - Cattle population decreases from 208.6 million in 2020 to 184.6 million by 2024
  - This results in a 14.1% decrease (30.4 million fewer cattle) over the period
  - Would require active government programs, economic incentives for herd reduction, and support for transitioning farmers

4. Climate Action - -5.0% annual decrease
  - Represents aggressive climate policy aligned with international commitments
  - Cattle population decreases from 204.3 million in 2020 to 166.4 million by 2024
  - This results in a 22.6% decrease (48.6 million fewer cattle) over the period
  - Would necessitate comprehensive economic restructuring, significant financial support for affected communities, and development of alternative agricultural systems

Comparative Analysis:

The range between scenarios is substantial:

  - BAU vs. Climate Action (2024): 63.4 million cattle difference (38.1% gap)
  - BAU: Returns to approximately 1997-1998 levels (229.8M vs. historical 234.9M in 1998)
  - Climate Action: Returns to approximately 1987 levels (166.4M vs. historical 142.8M in 1987)

Policy Context:

These scenarios reflect real-world tensions:

  - Brazil's cattle industry is economically vital, contributing significantly to GDP and employment
  - However, cattle farming is also a major contributor to deforestation, greenhouse gas emissions, and water stress
  - International climate commitments and domestic environmental concerns push for reduction
  - Economic realities and political pressures favor maintaining or growing the industry

James will now use Model 1 to forecast how each cattle scenario would impact Brazil's renewable freshwater resources, providing Moreno with quantitative evidence to inform policy decisions.

#### Scenario Forecasts

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Create scenarios for fpp3
cattle_scenarios <- scenarios(
  BAU = new_data(ttsibble_data, forecast_years) %>%
    mutate(Cattle...00000866....Stocks...005111....animals = scenario_data$BAU),
  
  Modest_Reduction = new_data(ttsibble_data, forecast_years) %>%
    mutate(Cattle...00000866....Stocks...005111....animals = scenario_data$Modest_Reduction),
  
  Aggressive_Reduction = new_data(ttsibble_data, forecast_years) %>%
    mutate(Cattle...00000866....Stocks...005111....animals = scenario_data$Aggressive_Reduction),
  
  Climate_Action = new_data(ttsibble_data, forecast_years) %>%
    mutate(Cattle...00000866....Stocks...005111....animals = scenario_data$Climate_Action),
  
  names_to = "Scenario"
)

# Generate forecasts for all scenarios
scenario_forecasts <- fit_ren_fresh %>%
  forecast(new_data = cattle_scenarios)

# Display forecast summary
forecast_summary <- scenario_forecasts %>%
  as_tibble() %>%
  group_by(Scenario) %>%
  summarize(
    `2020 Forecast` = .mean[1],
    `2024 Forecast` = .mean[5],
    `Total Change` = (.mean[5] - .mean[1]) / .mean[1] * 100,
    .groups = "drop"
  )

knitr::kable(
  forecast_summary,
  caption = "Renewable Freshwater Resources: Scenario Outcomes",
  digits = c(0, 10, 10, 2),
  col.names = c("Scenario", "2020 (m³)", "2024 (m³)", "% Change")
)
```

Using Model 1's dynamic regression framework, James generated forecasts for renewable freshwater resources under each cattle management scenario. The results reveal dramatically different trajectories depending on policy choices.

Forecast Results Summary:

The four scenarios produce strikingly divergent outcomes for Brazil's water resources over the 5-year forecast horizon:

1. Business as Usual (BAU) - Continued Decline
  - 2020: 0.0001309 m³
  - 2024: 0.0001136 m³
  - Change: -13.21% decrease
  - Interpretation: If cattle populations continue their historical growth trajectory, renewable freshwater resources will decline by over 13% in just five years, accelerating the already concerning depletion trend. This scenario leads to the worst outcome for water security.

2. Modest Reduction (-1% cattle annually) - Slight Recovery
  - 2020: 0.0001382 m³
  - 2024: 0.0001503 m³
  - Change: +8.81% increase
  - Interpretation: Even a modest 1% annual reduction in cattle numbers is sufficient to reverse the decline and achieve nearly 9% improvement in freshwater resources. This demonstrates that relatively achievable policy interventions can have meaningful positive impact.

3. Aggressive Reduction (-3% cattle annually) - Strong Recovery
  - 2020: 0.0001414 m³
  - 2024: 0.0001791 m³
  - Change: +24.04% increase
  - Interpretation: A 3% annual cattle reduction produces substantial improvement - nearly a quarter increase in renewable resources. By 2024, resources would approach levels not seen since approximately 1996, representing significant environmental recovery.

4. Climate Action (-5% cattle annually) - Dramatic Recovery
  - 2020: 0.0001507 m³
  - 2024: 0.0002056 m³
  - Change: +36.50% increase
  - Interpretation: The most aggressive scenario produces the most dramatic results - freshwater resources would increase by over one-third. By 2024, resources would reach 0.000206 m³, approaching 1993 levels and representing the strongest possible reversal of the depletion trend.

Critical Insights:

1. Policy Impact is Substantial: The difference between BAU and Climate Action scenarios is 81% by 2024 (0.000114 vs 0.000206 m³). This demonstrates that cattle management policies have enormous leverage over water resource outcomes.
2. Tipping Point Identified: The transition from BAU (decline) to Modest Reduction (recovery) occurs somewhere between +1.34% and -1.0% annual cattle growth. Even small interventions that slow growth could prevent further depletion.
3. Non-Linear Benefits: Moving from Modest (-1%) to Aggressive (-3%) reduction doubles the percentage gain (8.81% → 24.04%), while the cattle reduction rate only triples. This suggests increasing returns to more ambitious policies.
4. Comparison to Historical Baseline (2019 = 0.000126 m³):
  - BAU 2024: 9.8% below 2019 (accelerating decline)
  - Modest Reduction 2024: 19.1% above 2019 (recovery)
  - Aggressive Reduction 2024: 41.9% above 2019 (strong recovery)
  - Climate Action 2024: 62.9% above 2019 (dramatic recovery)

The Central Policy Question:

The forecasts present a stark choice: Brazil can either continue on a path of accelerating water resource depletion (BAU) or implement cattle reduction policies that not only halt decline but actively restore freshwater availability to levels not seen in decades.

The Aggressive Reduction scenario emerges as particularly compelling - it achieves substantial environmental benefits (+24% improvement, 42% above 2019) while requiring less dramatic economic restructuring than the Climate Action scenario.

#### Scenario Comparison Visualization

```{r scenario-visualization, include=TRUE, eval=TRUE, echo=TRUE, fig.width=14, fig.height=8}
# Create comprehensive comparison plot
# Plot historical data first, then add forecast scenarios
ttsibble_data %>%
  autoplot(Renewable.internal.freshwater.resources..cubic.meters, color = "black", size = 1) +
  autolayer(scenario_forecasts, level = NULL, size = 1.2) +
  labs(
    title = "Renewable Freshwater Resources: Impact of Cattle Management Policies",
    subtitle = "Forecast Scenarios (2020-2024)",
    x = "Year",
    y = "Renewable Internal Freshwater Resources (cubic meters)",
    color = "Scenario"
  ) +
  scale_color_manual(
    values = c(
      "BAU" = "#e74c3c",
      "Modest_Reduction" = "#f39c12", 
      "Aggressive_Reduction" = "#3498db",
      "Climate_Action" = "#27ae60"
    ),
    labels = c(
      "BAU" = "Business as Usual (+1.34%/yr)",
      "Modest_Reduction" = "Modest Reduction (-1%/yr)",
      "Aggressive_Reduction" = "Aggressive Reduction (-3%/yr)",
      "Climate_Action" = "Climate Action (-5%/yr)"
    )
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    legend.position = "bottom",
    legend.title = element_text(face = "bold")
  ) +
  geom_hline(yintercept = 0.0001262151, linetype = "dashed", color = "red", alpha = 0.5) +
  annotate("text", x = 2015, y = 0.0001262151, label = "2019 Level", 
           vjust = -0.5, color = "red", size = 3)
```

The visualization provides a powerful illustration of how cattle management policies could fundamentally alter Brazil's water resource trajectory over the next five years.

Visual Analysis:

Historical Context (Black Line, 1989-2019):

  - The historical data shows a consistent, nearly linear decline in renewable freshwater resources over three decades
  - From a peak of approximately 0.00026 m³ in 1989 to 0.000126 m³ in 2019
  - This represents the baseline trend that has persisted regardless of economic conditions or policy environments

2019 Reference Line (Red Dashed):

  - Marks the most recent historical observation (0.0001262 m³)
  - Serves as a critical threshold: scenarios above this line represent recovery; below indicates continued decline

Scenario Trajectories (2020-2024):

1. Business as Usual (Red Line) - The Crisis Scenario

  - Continues the downward trend established in the historical period
  - Crosses below the 2019 reference line, indicating accelerating depletion
  - By 2024, reaches approximately 0.000114 m³ - the lowest level in the entire 35-year timespan
  - Visual message: "Doing nothing leads to water crisis"

2. Modest Reduction (Orange Line) - The Stabilization Scenario

  - Shows a gentle upward slope, reversing the historical decline
  - Remains near the 2019 level, achieving approximate stabilization
  - By 2024, reaches approximately 0.000150 m³
  - Demonstrates that even minimal intervention can halt deterioration
  - Visual message: "Small changes prevent further decline"

3. Aggressive Reduction (Blue Line) - The Recovery Scenario

  - Displays a moderate upward trajectory, clearly separating from BAU
  - Rises well above the 2019 reference line
  - By 2024, reaches approximately 0.000179 m³
  - Shows meaningful environmental recovery while remaining achievable
  - Visual message: "Serious policy action enables recovery"

4. Climate Action (Green Line) - The Ambitious Scenario

  - Exhibits the steepest upward slope of all scenarios
  - Rises dramatically above 2019 levels
  - By 2024, reaches approximately 0.000206 m³ - approaching levels last seen in the early-to-mid 1990s
  - Represents the maximum achievable improvement under realistic assumptions
  - Visual message: "Transformative policy produces transformative results"

Key Visual Insights:

1. Dramatic Divergence: The four scenario lines fan out dramatically from 2020-2024, with the spread between BAU (lowest) and Climate Action (highest) representing an 81% difference by 2024. This visually emphasizes that policy choices have enormous consequences.
2. Reversal Point: The year 2019-2020 represents a critical juncture. The historical decline can either continue (red line) or be reversed (orange, blue, green lines). This is the "fork in the road" for Brazilian water policy.
3. Gradient of Intervention: The color progression (red → orange → blue → green) intuitively maps to increasing policy ambition, with corresponding improvements in outcomes. The visual spacing suggests roughly proportional relationships between cattle reduction rates and water resource recovery.
4. Recovery Timeline: The upward-sloping scenarios show that recovery happens quickly - within just 5 years, Brazil could restore resources to mid-1990s levels under aggressive policies. This contradicts any narrative that environmental recovery requires decades.
5. Historical Comparison: The Climate Action scenario (green) by 2024 would erase approximately half of the decline experienced from 1989-2019 (which took 30 years). This demonstrates the leverage of focused policy intervention.

Policy Communication Value:

This visualization is particularly effective for stakeholder communication because it:
  - Shows consequences visually rather than just numerically
  - Emphasizes urgency - BAU leads to unprecedented lows
  - Demonstrates feasibility - even modest intervention helps
  - Provides options - four distinct pathways with different trade-offs
  - Uses intuitive colors - red (danger), orange (caution), blue (moderate action), green (strong action)

The Central Message:

The visualization makes clear that Brazil's water future is not predetermined. While three decades of decline might suggest inevitability, the diverging forecast lines demonstrate that policy choices made in 2020-2024 could either:

  - Accelerate the crisis (BAU scenario - red line below all historical data)
  - Reverse the trend entirely (Climate Action - green line approaching 1990s levels)

The visual gap between these extremes represents the quantified value of policy action - approximately 0.00009 m³, or 81% difference in outcomes based solely on cattle management decisions.

#### Detailed Scenario Analysis

```{r, include=TRUE, eval=TRUE, echo=TRUE}
# Calculate key metrics for each scenario
scenario_metrics <- scenario_forecasts %>%
  as_tibble() %>%
  filter(Year == 2024) %>%
  mutate(
    Change_from_2019 = (.mean - 0.0001262151) / 0.0001262151 * 100,
    Annual_Change_Rate = ((.mean / 0.0001262151)^(1/5) - 1) * 100
  ) %>%
  select(Scenario, `2024_Value` = .mean, Change_from_2019, Annual_Change_Rate)

knitr::kable(
  scenario_metrics,
  caption = "5-Year Impact Analysis (2019 to 2024)",
  digits = c(0, 10, 2, 2),
  col.names = c("Scenario", "2024 Value (m³)", "Total Change (%)", "Avg Annual Rate (%)")
)
```

To quantify the long-term impact of each policy scenario, James calculated key performance metrics comparing 2024 outcomes to the 2019 baseline (0.0001262 m³). This analysis reveals the compounded effects of sustained policy implementation over the five-year period.

5-Year Impact Metrics:

1. Business as Usual (BAU) - Accelerating Decline
  - 2024 Endpoint: 0.0001136 m³
  - Total Change from 2019: -10.01% decline
  - Average Annual Rate: -2.09% per year

Analysis: The BAU scenario shows Brazil's water crisis worsening at an accelerating pace. The -2.09% annual rate is actually slower than the historical -2.36% rate observed from 1989-2019, but still represents significant ongoing depletion. By 2024, renewable freshwater resources would fall to their lowest level in recorded history, 10% below the already-depleted 2019 baseline.

Implication: This is the "do nothing" scenario outcome - continued resource degradation threatening long-term water security.

2. Modest Reduction (-1% cattle) - Reversal Achieved

  - 2024 Endpoint: 0.0001503 m³
  - Total Change from 2019: +19.12% increase
  - Average Annual Rate: +3.56% per year

Analysis: Even a modest 1% annual cattle reduction is sufficient to completely reverse the historical decline and achieve substantial recovery. The +3.56% annual improvement rate represents a 5.65 percentage point swing from BAU (-2.09%), demonstrating that relatively small policy interventions have disproportionate positive impacts.

Implication: This scenario proves that reversing water resource depletion is achievable without radical economic restructuring. A 19% improvement in five years would restore resources to approximately 2001 levels.

3. Aggressive Reduction (-3% cattle) - Significant Recovery

  - 2024 Endpoint: 0.0001791 m³
  - Total Change from 2019: +41.92% increase
  - Average Annual Rate: +7.25% per year

Analysis: The 3% cattle reduction scenario produces dramatic environmental recovery - a 42% improvement that would restore freshwater resources to approximately 1996 levels. The 7.25% annual rate represents nearly triple the improvement of the Modest Reduction scenario (3.56%), despite only tripling the cattle reduction rate. This suggests increasing returns to policy ambition.

Implication: This scenario represents the optimal balance between environmental benefit and economic feasibility. A 42% resource increase would significantly enhance water security while remaining politically and economically achievable.

4. Climate Action (-5% cattle) - Transformational Recovery

  - 2024 Endpoint: 0.0002056 m³
  - Total Change from 2019: +62.92% increase
  - Average Annual Rate: +10.25% per year

Analysis: The most ambitious scenario produces transformational results - resources would increase by nearly two-thirds, reaching levels not seen since approximately 1993. The 10.25% annual improvement rate is remarkable given it represents a 12.34 percentage point swing from BAU in just five years. This scenario would restore more than half of the total decline experienced over the previous 30 years (1989-2019).

Implication: While this scenario requires the most dramatic policy intervention, it demonstrates that rapid environmental recovery is physically possible. This provides hope that even decades of degradation can be reversed with sufficient political will.

Comparative Analysis:

The Scale of Policy Impact:
  - Spread between best and worst: 62.92% - (-10.01%) = 72.93 percentage points
  - 2024 value range: 0.0001136 to 0.0002056 m³ = 81% difference between BAU and Climate Action
  - Annual rate range: -2.09% to +10.25% = 12.34 percentage point swing in trajectory

Efficiency of Intervention:
Comparing the marginal benefit of increased policy ambition:

  - BAU → Modest (2.34% cattle change): +29.13% resource improvement
  - Modest → Aggressive (additional 2% cattle change): +22.80% additional improvement
  - Aggressive → Climate Action (additional 2% cattle change): +21.00% additional improvement

This shows diminishing but still substantial returns - each incremental 2% cattle reduction yields approximately 20-29% additional freshwater improvement.

Time to Recovery:

  - Modest Reduction: Returns to ~2001 levels by 2024 (recovery of 18 years of decline)
  - Aggressive Reduction: Returns to ~1996 levels by 2024 (recovery of 23 years of decline)
  - Climate Action: Returns to ~1993 levels by 2024 (recovery of 26 years of decline)

In other words, aggressive policies can recover 2-3 decades of environmental damage in just 5 years.

The Policy Choice:

  - This analysis quantifies what is at stake: Brazil can either:
  - Accept continued decline (BAU: -10% by 2024, lowest levels ever)
  - Achieve modest stabilization (Modest: +19%, return to 2001 levels)
  - Accomplish significant recovery (Aggressive: +42%, return to 1996 levels) ← RECOMMENDED
  - Pursue transformational restoration (Climate Action: +63%, return to 1993 levels)

The average annual rate metric is particularly telling: it takes only 3.56% annual improvement to reverse decades of decline, while 7.25% annual improvement produces dramatic environmental recovery. These rates are achievable with focused cattle management policies, making meaningful water resource restoration a realistic near-term goal rather than a distant aspiration.

## Conclusions

After conducting comprehensive analysis using NHTSA FARS data for Minnesota fatal crashes and comparing multiple modeling approaches, James presents the following conclusions and recommendations to Moreno for Brazil's renewable freshwater resources forecast:

Key Findings:

1. Model Selection and Reliability

Of the two dynamic regression models tested, Model 1 (cattle numbers as predictor) demonstrated superior performance and should be used for all forecasting and policy planning. Model 1 achieved better model fit (AIC: -617.2 vs -507.2), smaller error variance, and produced credible forecasts aligned with historical trends. Model 2 (freshwater withdrawals as predictor) failed diagnostically, showing near-zero predictor coefficients and producing implausible flat forecasts that contradict 30 years of observed patterns.

2. Baseline Forecast (Business as Usual)

If current trends continue with cattle populations growing at historical rates, Brazil's renewable freshwater resources will decline by 22.5% over the next decade, falling from 0.000132 m³ in 2020 to 0.000103 m³ by 2029. This represents an acceleration of the already concerning 51% depletion observed from 1989-2019 and would push resources to their lowest levels in recorded history.

3. The Policy Opportunity

Scenario analysis reveals that modest cattle management interventions can completely reverse the decline. Even a 1% annual cattle reduction would produce a 19% resource improvement by 2024, while a 3% annual reduction (Aggressive Reduction scenario) would achieve a 42% improvement, restoring resources to mid-1990s levels. The analysis demonstrates that decades of environmental damage can be reversed within 5 years through focused policy action.

Primary Recommendation:

Implement the Aggressive Reduction scenario as Brazil's target policy: Achieve a 3% annual decrease in cattle populations through a combination of improved efficiency, economic incentives for herd reduction, and support for transitioning farmers. This scenario represents the optimal balance between environmental necessity and economic feasibility, offering substantial water resource recovery (+42% by 2024) while remaining politically achievable.

Implementation Roadmap:

  - Immediate (2020-2021): Establish baseline monitoring, conduct stakeholder consultations, design incentive programs, and secure funding mechanisms
  - Short-term (2021-2022): Launch pilot reduction programs in water-stressed regions, provide technical assistance for productivity improvements, and develop economic transition support
  - Medium-term (2022-2024): Scale successful interventions nationally, monitor progress against 3% annual reduction target, and adjust policies based on outcomes
  - Long-term (2024-2029): Assess feasibility of accelerating to Climate Action scenario (5% reduction) if initial targets met and economic transitions successful

Critical Success Factors:

The analysis demonstrates that policy inaction carries severe consequences—continued depletion threatens Brazil's long-term water security, agricultural sustainability, and economic stability. However, the scenario analysis also provides optimism: reversing environmental decline is not only possible but achievable within a single presidential term. The mathematical relationship between cattle populations and renewable freshwater resources is clear and quantified, providing policymakers with predictable outcomes for different intervention levels.

Final Insight:

Brazil stands at a critical juncture. The 2020-2024 period represents a "fork in the road" where policy choices will determine whether freshwater resources continue their three-decade decline toward crisis levels or reverse course toward environmental recovery and enhanced water security. The data unequivocally shows that ambitious but achievable cattle management policies can restore Brazil's renewable freshwater resources to 1990s levels within five years, providing a rare example of rapid environmental recovery through focused intervention.

The choice is clear: implement cattle reduction policies now and achieve measurable environmental recovery by 2024, or accept accelerating water resource depletion and the economic and social consequences that follow. James recommends the former—targeted action guided by data-driven forecasting to secure Brazil's water future for generations to come.

## Final Summary

```{r, include=TRUE, eval=TRUE, echo=TRUE}
summary_table <- data.frame(
  Metric = c(
    "Historical Trend (1989-2019)",
    "Business as Usual Forecast (2019-2029)",
    "Recommended Policy Target",
    "Optimistic Climate Scenario"
  ),
  `Annual Rate` = c(
    "-2.36%",
    "-2.5% (est.)",
    "-3% cattle reduction",
    "-5% cattle reduction"
  ),
  Outcome = c(
    "51% resource decline",
    "Continued acceleration",
    "Stabilization by 2025",
    "Possible recovery"
  )
)

knitr::kable(
  summary_table,
  caption = "Summary of Findings and Recommendations",
  col.names = c("Scenario", "Annual Rate", "Expected Outcome")
) %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
```

James's Recommendation to Moreno

This summary table distills the entire analysis into a clear, actionable framework for decision-making. It presents four critical benchmarks that define Brazil's water resource trajectory:

Understanding the Summary:

1. Historical Trend (1989-2019) - The Baseline Reality
  - Annual Rate: -2.36% per year
  - Outcome: 51% resource decline over 30 years
  - Significance: This represents three decades of consistent depletion driven primarily by cattle population growth (1.34% annually). It establishes the severity of the problem and demonstrates that without intervention, decline is the default trajectory.

2. Business as Usual Forecast (2019-2029) - The Path to Crisis
  - Annual Rate: -2.5% per year (estimated)
  - Outcome: Continued acceleration of depletion
  - Significance: The BAU scenario shows the problem is worsening, not stabilizing. The -2.5% rate, while slightly slower than the historical -2.36%, still represents accelerating decline when compounded over time. This scenario leads to unprecedented resource lows and escalating water security risks.

3. Recommended Policy Target - The Pragmatic Solution ⭐
  - Annual Rate: -3% cattle reduction per year
  - Outcome: Stabilization by 2025
  - Significance: This is James's primary recommendation to Moreno. A 3% annual cattle reduction (Aggressive Reduction scenario) represents the optimal balance between environmental necessity and economic feasibility. It would:
    - Achieve +42% resource improvement by 2024 (from scenario analysis)
    - Restore resources to mid-1990s levels
    - Require substantial but achievable policy intervention
    - Provide measurable results within a single political term
  - Key message: "This is the target Brazil should commit to implementing immediately."

4. Optimistic Climate Scenario - The Aspirational Goal
  - Annual Rate: -5% cattle reduction per year
  - Outcome: Possible recovery to pre-1990 levels
  - Significance: The Climate Action scenario represents the maximum achievable improvement under realistic assumptions. While requiring dramatic economic restructuring, it demonstrates that even decades of environmental damage can be rapidly reversed (+63% improvement by 2024). This serves as a:
    - Long-term aspirational target
    - Benchmark for what's physically possible
    - Potential escalation path if initial 3% targets are successfully met

The Table's Strategic Communication:

This summary is particularly effective because it:

1. Provides Context: Shows where Brazil has been (Historical), where it's headed (BAU), and where it could go (Policy options)
2. Frames the Choice: Presents decision-makers with clear alternatives rather than just one forecast
3. Emphasizes Urgency: The contrast between "Continued acceleration" (BAU) and "Stabilization by 2025" (Recommended) makes the case for immediate action
4. Balances Ambition: Offers both a pragmatic target (3%) and an aspirational one (5%), acknowledging political and economic realities while showing what's ultimately possible
5. Uses Simple Metrics: Annual rates and outcomes are easily understood by non-technical stakeholders

Executive Summary for Moreno:

"Over the past 30 years, Brazil lost 51% of its renewable freshwater resources at a rate of 2.36% annually. Without intervention, this decline will accelerate. However, by implementing a 3% annual cattle reduction policy, Brazil can achieve stabilization by 2025 and restore resources to 1990s levels. A more ambitious 5% reduction could enable full recovery. The choice is clear: act decisively now with the 3% target, or accept continued resource depletion and the economic consequences that follow. I recommend immediate implementation of the 3% cattle reduction policy as Brazil's water security strategy for the next decade."

## References:

https://ourworldindata.org/grapher/renewable-water-resources-per-capita?time=earliest..2019&country=BRA~OWID_WRL~USA~ARE

https://ourworldindata.org/grapher/annual-freshwater-withdrawals?tab=chart&country=OWID_WRL~BRA~USA

https://data.worldbank.org/indicator/SP.POP.TOTL?end=2019&locations=BR&start=1989&view=chart 

https://ourworldindata.org/grapher/cattle-livestock-count-heads?tab=chart&country=BRA~OWID_WRL 
